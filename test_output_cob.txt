============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.4.2, pluggy-1.6.0
rootdir: C:\codex\databarn
plugins: typeguard-4.4.4
collected 6 items

tests\test_cob.py .F..F.                                                 [100%]

================================== FAILURES ===================================
__________________________ test_cob_static_violation __________________________

    def test_cob_static_violation():
        """Test that a static Cob does not allow new grains."""
        class StaticModel(Cob):
            name: str = Grain()
    
        cob = StaticModel(name="Static")
        assert cob.__dna__.dynamic is False
    
        # Test __setattr__ violation
>       with pytest.raises(StaticModelViolationError):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       Failed: DID NOT RAISE <class 'databarn.exceptions.StaticModelViolationError'>

tests\test_cob.py:35: Failed
___________________________ test_cob_initialization ___________________________

    def test_cob_initialization():
        """Test initialization with args and kwargs."""
        class Point(Cob):
            x: int = Grain()
            y: int = Grain()
    
        # Keyword init
        p1 = Point(x=1, y=2)
        assert p1.x == 1
        assert p1.y == 2
    
        # Positional init
        p2 = Point(10, 20)
        assert p2.x == 10
        assert p2.y == 20
    
        # Mixed (not allowed if positional covers keywords, check logic)
        # The logic says: cannot assign value to grain ... both positionally and as keyword
        with pytest.raises(DataBarnSyntaxError):
>           Point(10, x=5)

tests\test_cob.py:121: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = Point(x=<Unset>, y=<Unset>), args = (10,), kwargs = {'x': 5}
dna = <databarn.dna.dna_factory.<locals>.Dna object at 0x000002E275D52060>
seeds = (Seed(label='x', type=<class 'int'>, default=None, pk=False, required=False, auto=False, frozen=False, unique=False, c...None, is_child_barn_ref=False, info=Info()), cob=Point(x=<Unset>, y=<Unset>), get_value()=<Unset>, has_been_set=False))
seed = Seed(label='x', type=<class 'int'>, default=None, pk=False, required=False, auto=False, frozen=False, unique=False, co...=None, is_child_barn_ref=False, info=Info()), cob=Point(x=<Unset>, y=<Unset>), get_value()=<Unset>, has_been_set=False)
argname_value_map = {}, index = 0, value = 10

    def __init__(self, *args, **kwargs):
        """Initializes a Cob-like object.
    
        - Positional args are assigned to the grains in the order they were
        declared in the Cob-model (allowed only for static models).
        - Keyword args are assigned to the cob grains by name (allowed for both
        static and dynamic models).
        - If @create_child_barn_grain was applied, its factory() is set
        first, before any other assignment.
        - If a grain is not assigned a value, its default is assigned.
        - If a grain is assigned both positionally and as a keyword arg, an error
        is raised.
        - If a grain is assigned that is not defined in the model, an error is
        raised for static models, or a new grain is created for dynamic models.
    
        After all assignments, the `__post_init__` method is called, if defined.
    
        Args:
            *args: positional args to be assigned to grains
            **kwargs: keyword args to be assigned to grains
        """
        dna = self.__dna__(self)  # Create an object-level __dna__
        self.__dict__.update(__dna__=dna)  # Bypass __setattr__
    
        seeds = self.__dna__.seeds
    
        for seed in seeds:
            if seed.factory:
                setattr(self, seed.label, seed.factory())
    
        if self.__dna__.dynamic and args:
            raise DataBarnSyntaxError(fo(f"""
                Positional args cannot be provided to initialize
                '{type(self).__name__}' because no grain has been defined
                in the Cob-model. Use only keyword args to assign
                grain values dynamically."""))
        elif len(args) > len(seeds):
            raise DataBarnSyntaxError(fo(f"""
                Too many positional args provided to initialize
                '{type(self).__name__}'. Expected at most {len(seeds)},
                got {len(args)}."""))
    
        argname_value_map = {}
    
        # Static model assignment by position
        for index, value in enumerate(args):
            seed = seeds[index]
            if seed.label in kwargs:
                raise DataBarnSyntaxError(fo(f"""
>                   Cannot assign value to grain '{arg_name}' both
                                                   ^^^^^^^^
                    positionally and as a keyword arg."""))
E               NameError: name 'arg_name' is not defined

databarn\cob.py:86: NameError
=========================== short test summary info ===========================
FAILED tests/test_cob.py::test_cob_static_violation - Failed: DID NOT RAISE <...
FAILED tests/test_cob.py::test_cob_initialization - NameError: name 'arg_name...
========================= 2 failed, 4 passed in 0.23s =========================
